@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<Umbraco.Cms.Core.Models.Blocks.BlockGridItem>

@using Umbraco.Extensions
@using Umbraco.Cms.Core.PublishedCache
@using Umbraco.Cms.Core.Services.Navigation
@using Umbraco.Cms.Core.Models

@inject IPublishedValueFallback PublishedValueFallback
@inject IVariationContextAccessor VariationContextAccessor
@inject IPublishedContentCache PublishedContentCache
@inject IDocumentNavigationQueryService DocumentNavigationQueryService

@{
	var parentPage = Model.Content.Value<IPublishedContent>("parentPage");

	if (parentPage != null)
	{
		var events = parentPage.Children(VariationContextAccessor, PublishedContentCache, DocumentNavigationQueryService).Where(x => x.IsVisible(PublishedValueFallback)).ToArray();

		@if (events?.Length > 0)
		{
            <div class="row">
                @* Loop through the selection *@
                @foreach (var eventItem in events)
                {
                    var name = eventItem.Name;
                    var promoImage = eventItem.Value<MediaWithCrops>("promoImage");
                    var promoImageUrl = "";
                    var promoImageUrlCrop = "";
                    var promoImageHeight = 0;
                    var promoImageWidth = 0;
                    var promoImageClass = "";

                    if (promoImage != null)
                    {
                        promoImageUrl = promoImage.MediaUrl();
                        promoImageUrlCrop = promoImage.GetCropUrl("square");
                        promoImageHeight = promoImage.Value<int>("umbracoHeight");
                        promoImageWidth = promoImage.Value<int>("umbracoWidth");
                        promoImageClass = promoImageWidth > promoImageHeight ? "img-landscape" : "img-portrait";
                        promoImageClass = promoImageWidth == promoImageHeight ? "img-square" : promoImageClass;
                    }

                    var daysTimes = eventItem.Value("daysTimes");
                    var description = eventItem.Value("description");
                    var admission = eventItem.Value("admission");

                    <div class="event-item col s12">
                        <div class="card horizontal">
                            @if (promoImage != null)
                            {
                                <div class="card-image">
                                    <img src="@promoImageUrlCrop" class="@promoImageClass" alt="@name" />
                                </div>
                            }
                            <div class="card-stacked">
                                <div class="card-content">
                                    <span class="card-title">@name</span>
                                    @if (@daysTimes != null)
                                    {
                                        <p class="days-times"><b>@daysTimes</b></p>
                                    }
                                    @if (@admission != null)
                                    {
                                        <p class="admission"><b>@admission</b></p>
                                    }
                                    @if (description != null)
                                    {
                                        @description
                                    }
                                </div>
                            </div>
                        </div>                        
                    </div>
                }
            </div>
		}
	}
}